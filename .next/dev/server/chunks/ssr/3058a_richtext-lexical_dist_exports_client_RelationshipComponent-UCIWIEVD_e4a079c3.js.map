{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/stefaniedoll/websites/prepublic/epaper-backend/node_modules/.pnpm/%40payloadcms%2Brichtext-lexical%403.64.0_%40faceless-ui%2Bmodal%403.0.0_react-dom%4019.0.0_react%4019._bd7baf48251713852e8e278ca79c7dae/node_modules/%40payloadcms/richtext-lexical/src/features/relationship/client/components/RelationshipComponent.tsx"],"sourcesContent":["'use client'\nimport type { ElementFormatType } from 'lexical'\n\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext.js'\nimport { useLexicalEditable } from '@lexical/react/useLexicalEditable'\nimport { getTranslation } from '@payloadcms/translations'\nimport { Button, useConfig, usePayloadAPI, useTranslation } from '@payloadcms/ui'\nimport { $getNodeByKey } from 'lexical'\nimport React, { useCallback, useReducer, useRef, useState } from 'react'\n\nimport type { RelationshipData } from '../../server/nodes/RelationshipNode.js'\n\nimport { useLexicalDocumentDrawer } from '../../../../utilities/fieldsDrawer/useLexicalDocumentDrawer.js'\nimport './index.scss'\nimport { INSERT_RELATIONSHIP_WITH_DRAWER_COMMAND } from '../drawer/commands.js'\n\nconst initialParams = {\n  depth: 0,\n}\n\ntype Props = {\n  className: string\n  data: RelationshipData\n  format?: ElementFormatType\n  nodeKey?: string\n}\n\nexport const RelationshipComponent: React.FC<Props> = (props) => {\n  const {\n    className: baseClass,\n    data: { relationTo, value },\n    nodeKey,\n  } = props\n\n  if (typeof value === 'object') {\n    throw new Error(\n      'Relationship value should be a string or number. The Lexical Relationship component should not receive the populated value object.',\n    )\n  }\n\n  const relationshipElemRef = useRef<HTMLDivElement | null>(null)\n\n  const [editor] = useLexicalComposerContext()\n  const isEditable = useLexicalEditable()\n  const {\n    config: {\n      routes: { api },\n      serverURL,\n    },\n    getEntityConfig,\n  } = useConfig()\n\n  const [relatedCollection] = useState(() => getEntityConfig({ collectionSlug: relationTo }))\n\n  const { i18n, t } = useTranslation()\n  const [cacheBust, dispatchCacheBust] = useReducer((state) => state + 1, 0)\n  const [{ data }, { setParams }] = usePayloadAPI(\n    `${serverURL}${api}/${relatedCollection.slug}/${value}`,\n    { initialParams },\n  )\n\n  const { closeDocumentDrawer, DocumentDrawer, DocumentDrawerToggler } = useLexicalDocumentDrawer({\n    id: value,\n    collectionSlug: relatedCollection.slug,\n  })\n\n  const removeRelationship = useCallback(() => {\n    editor.update(() => {\n      $getNodeByKey(nodeKey!)?.remove()\n    })\n  }, [editor, nodeKey])\n\n  const updateRelationship = React.useCallback(() => {\n    setParams({\n      ...initialParams,\n      cacheBust, // do this to get the usePayloadAPI to re-fetch the data even though the URL string hasn't changed\n    })\n\n    closeDocumentDrawer()\n    dispatchCacheBust()\n  }, [cacheBust, setParams, closeDocumentDrawer])\n\n  return (\n    <div className={`${baseClass}__contents`} contentEditable={false} ref={relationshipElemRef}>\n      <div className={`${baseClass}__wrap`}>\n        <p className={`${baseClass}__label`}>\n          {t('fields:labelRelationship', {\n            label: relatedCollection.labels?.singular\n              ? getTranslation(relatedCollection.labels?.singular, i18n)\n              : relatedCollection.slug,\n          })}\n        </p>\n        <DocumentDrawerToggler className={`${baseClass}__doc-drawer-toggler`}>\n          <p className={`${baseClass}__title`}>\n            {data ? data[relatedCollection?.admin?.useAsTitle || 'id'] : value}\n          </p>\n        </DocumentDrawerToggler>\n      </div>\n      {isEditable && (\n        <div className={`${baseClass}__actions`}>\n          <Button\n            buttonStyle=\"icon-label\"\n            className={`${baseClass}__swapButton`}\n            disabled={!isEditable}\n            el=\"button\"\n            icon=\"swap\"\n            onClick={() => {\n              if (nodeKey) {\n                editor.dispatchCommand(INSERT_RELATIONSHIP_WITH_DRAWER_COMMAND, {\n                  replace: { nodeKey },\n                })\n              }\n            }}\n            round\n            tooltip={t('fields:swapRelationship')}\n          />\n          <Button\n            buttonStyle=\"icon-label\"\n            className={`${baseClass}__removeButton`}\n            disabled={!isEditable}\n            icon=\"x\"\n            onClick={(e) => {\n              e.preventDefault()\n              removeRelationship()\n            }}\n            round\n            tooltip={t('fields:removeRelationship')}\n          />\n        </div>\n      )}\n\n      {!!value && <DocumentDrawer onSave={updateRelationship} />}\n    </div>\n  )\n}\n"],"names":["useLexicalComposerContext", "useLexicalEditable", "getTranslation", "Button", "useConfig", "usePayloadAPI", "useTranslation", "$getNodeByKey", "React", "useCallback", "useReducer", "useRef", "useState", "initialParams", "depth", "RelationshipComponent", "props", "className", "baseClass", "data", "relationTo", "value", "nodeKey", "Error", "relationshipElemRef", "useRef", "editor", "useLexicalComposerContext", "isEditable", "useLexicalEditable", "config", "routes", "api", "serverURL", "getEntityConfig", "useConfig", "relatedCollection", "useState", "collectionSlug", "i18n", "t", "useTranslation", "cacheBust", "dispatchCacheBust", "useReducer", "state", "setParams", "usePayloadAPI", "slug", "closeDocumentDrawer", "DocumentDrawer", "DocumentDrawerToggler", "useLexicalDocumentDrawer", "id", "removeRelationship", "useCallback", "update", "$getNodeByKey", "remove", "updateRelationship", "React", "_jsxs", "contentEditable", "ref", "_jsx", "label", "labels", "singular", "getTranslation", "admin", "useAsTitle", "Button", "buttonStyle", "disabled", "el", "icon", "onClick", "dispatchCommand", "INSERT_RELATIONSHIP_WITH_DRAWER_COMMAND", "replace", "round", "tooltip", "e", "preventDefault", "onSave"],"mappings":"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"}}]
}