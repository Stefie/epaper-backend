{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 260, "column": 0}, "map": {"version":3,"sources":["file:///Users/stefaniedoll/websites/prepublic/epaper-backend/src/utilities/extractID.ts"],"sourcesContent":["import { Config } from '@/payload-types'\nimport type { CollectionSlug } from 'payload'\n\nexport const extractID = <T extends Config['collections'][CollectionSlug]>(\n  objectOrID: T | T['id'],\n): T['id'] => {\n  if (objectOrID && typeof objectOrID === 'object') return objectOrID.id\n\n  return objectOrID\n}\n"],"names":[],"mappings":";;;;AAGO,MAAM,YAAY,CACvB;IAEA,IAAI,cAAc,OAAO,eAAe,UAAU,OAAO,WAAW,EAAE;IAEtE,OAAO;AACT"}},
    {"offset": {"line": 272, "column": 0}, "map": {"version":3,"sources":["file:///Users/stefaniedoll/websites/prepublic/epaper-backend/src/utilities/getUserTenantIDs.ts"],"sourcesContent":["import type { Tenant, User } from '../payload-types'\nimport { extractID } from './extractID'\n\n/**\n * Returns array of all tenant IDs assigned to a user\n *\n * @param user - User object with tenants field\n * @param role - Optional role to filter by\n */\nexport const getUserTenantIDs = (\n  user: null | User,\n  role?: NonNullable<User['tenants']>[number]['roles'][number],\n): Tenant['id'][] => {\n  if (!user) {\n    return []\n  }\n\n  return (\n    user?.tenants?.reduce<Tenant['id'][]>((acc, { roles, tenant }) => {\n      if (role && !roles.includes(role)) {\n        return acc\n      }\n\n      if (tenant) {\n        acc.push(extractID(tenant))\n      }\n\n      return acc\n    }, []) || []\n  )\n}\n"],"names":[],"mappings":";;;;AACA;;AAQO,MAAM,mBAAmB,CAC9B,MACA;IAEA,IAAI,CAAC,MAAM;QACT,OAAO,EAAE;IACX;IAEA,OACE,MAAM,SAAS,OAAuB,CAAC,KAAK,EAAE,KAAK,EAAE,MAAM,EAAE;QAC3D,IAAI,QAAQ,CAAC,MAAM,QAAQ,CAAC,OAAO;YACjC,OAAO;QACT;QAEA,IAAI,QAAQ;YACV,IAAI,IAAI,CAAC,IAAA,4IAAS,EAAC;QACrB;QAEA,OAAO;IACT,GAAG,EAAE,KAAK,EAAE;AAEhB"}},
    {"offset": {"line": 296, "column": 0}, "map": {"version":3,"sources":["file:///Users/stefaniedoll/websites/prepublic/epaper-backend/src/collections/Pages/hooks/ensureUniqueSlug.ts"],"sourcesContent":["import type { FieldHook, Where } from 'payload'\n\nimport { ValidationError } from 'payload'\n\nimport { getUserTenantIDs } from '../../../utilities/getUserTenantIDs'\nimport { extractID } from '@/utilities/extractID'\n\nexport const ensureUniqueSlug: FieldHook = async ({ data, originalDoc, req, value }) => {\n  // if value is unchanged, skip validation\n  if (originalDoc.slug === value) {\n    return value\n  }\n\n  const constraints: Where[] = [\n    {\n      slug: {\n        equals: value,\n      },\n    },\n  ]\n\n  const incomingTenantID = extractID(data?.tenant)\n  const currentTenantID = extractID(originalDoc?.tenant)\n  const tenantIDToMatch = incomingTenantID || currentTenantID\n\n  if (tenantIDToMatch) {\n    constraints.push({\n      tenant: {\n        equals: tenantIDToMatch,\n      },\n    })\n  }\n\n  const findDuplicatePages = await req.payload.find({\n    collection: 'pages',\n    where: {\n      and: constraints,\n    },\n  })\n\n  if (findDuplicatePages.docs.length > 0 && req.user) {\n    const tenantIDs = getUserTenantIDs(req.user)\n    // if the user is an admin or has access to more than 1 tenant\n    // provide a more specific error message\n    if (req.user.roles?.includes('super-admin') || tenantIDs.length > 1) {\n      const attemptedTenantChange = await req.payload.findByID({\n        id: tenantIDToMatch,\n        collection: 'tenants',\n      })\n\n      throw new ValidationError({\n        errors: [\n          {\n            message: `The \"${attemptedTenantChange.name}\" tenant already has a page with the slug \"${value}\". Slugs must be unique per tenant.`,\n            path: 'slug',\n          },\n        ],\n      })\n    }\n\n    throw new ValidationError({\n      errors: [\n        {\n          message: `A page with the slug ${value} already exists. Slug must be unique per tenant.`,\n          path: 'slug',\n        },\n      ],\n    })\n  }\n\n  return value\n}\n"],"names":[],"mappings":";;;;AAEA;AAEA;AACA;;;;AAEO,MAAM,mBAA8B,OAAO,EAAE,IAAI,EAAE,WAAW,EAAE,GAAG,EAAE,KAAK,EAAE;IACjF,yCAAyC;IACzC,IAAI,YAAY,IAAI,KAAK,OAAO;QAC9B,OAAO;IACT;IAEA,MAAM,cAAuB;QAC3B;YACE,MAAM;gBACJ,QAAQ;YACV;QACF;KACD;IAED,MAAM,mBAAmB,IAAA,4IAAS,EAAC,MAAM;IACzC,MAAM,kBAAkB,IAAA,4IAAS,EAAC,aAAa;IAC/C,MAAM,kBAAkB,oBAAoB;IAE5C,IAAI,iBAAiB;QACnB,YAAY,IAAI,CAAC;YACf,QAAQ;gBACN,QAAQ;YACV;QACF;IACF;IAEA,MAAM,qBAAqB,MAAM,IAAI,OAAO,CAAC,IAAI,CAAC;QAChD,YAAY;QACZ,OAAO;YACL,KAAK;QACP;IACF;IAEA,IAAI,mBAAmB,IAAI,CAAC,MAAM,GAAG,KAAK,IAAI,IAAI,EAAE;QAClD,MAAM,YAAY,IAAA,0JAAgB,EAAC,IAAI,IAAI;QAC3C,8DAA8D;QAC9D,wCAAwC;QACxC,IAAI,IAAI,IAAI,CAAC,KAAK,EAAE,SAAS,kBAAkB,UAAU,MAAM,GAAG,GAAG;YACnE,MAAM,wBAAwB,MAAM,IAAI,OAAO,CAAC,QAAQ,CAAC;gBACvD,IAAI;gBACJ,YAAY;YACd;YAEA,MAAM,IAAI,yRAAe,CAAC;gBACxB,QAAQ;oBACN;wBACE,SAAS,CAAC,KAAK,EAAE,sBAAsB,IAAI,CAAC,2CAA2C,EAAE,MAAM,mCAAmC,CAAC;wBACnI,MAAM;oBACR;iBACD;YACH;QACF;QAEA,MAAM,IAAI,yRAAe,CAAC;YACxB,QAAQ;gBACN;oBACE,SAAS,CAAC,qBAAqB,EAAE,MAAM,gDAAgD,CAAC;oBACxF,MAAM;gBACR;aACD;QACH;IACF;IAEA,OAAO;AACT"}},
    {"offset": {"line": 367, "column": 0}, "map": {"version":3,"sources":["file:///Users/stefaniedoll/websites/prepublic/epaper-backend/src/access/isSuperAdmin.ts"],"sourcesContent":["import type { Access } from 'payload'\nimport { User } from '../payload-types'\n\nexport const hasSuperAdminAccess: Access = ({ req }): boolean => {\n  return isSuperAdmin(req.user)\n}\n\nexport const isSuperAdmin = (user: User | null): boolean => {\n  return Boolean(user?.roles?.includes('super-admin'))\n}\n"],"names":[],"mappings":";;;;;;AAGO,MAAM,sBAA8B,CAAC,EAAE,GAAG,EAAE;IACjD,OAAO,aAAa,IAAI,IAAI;AAC9B;AAEO,MAAM,eAAe,CAAC;IAC3B,OAAO,QAAQ,MAAM,OAAO,SAAS;AACvC"}},
    {"offset": {"line": 383, "column": 0}, "map": {"version":3,"sources":["file:///Users/stefaniedoll/websites/prepublic/epaper-backend/src/access/superAdminOrTenantAdmin.ts"],"sourcesContent":["import { getUserTenantIDs } from '@/utilities/getUserTenantIDs'\nimport { isSuperAdmin } from './isSuperAdmin'\nimport { Access } from 'payload'\nimport { User } from '../payload-types'\n\n/**\n * Tenant admins and super admins can will be allowed access\n */\nexport const hasSuperAdminOrAdminAccess: Access = ({ req }) => {\n  if (!req.user) {\n    return false\n  }\n\n  if (isSuperAdmin(req.user)) {\n    return true\n  }\n\n  const adminTenantAccessIDs = getUserTenantIDs(req.user, 'tenant-admin')\n  const requestedTenant = req?.data?.tenant\n\n  if (requestedTenant && adminTenantAccessIDs.includes(requestedTenant)) {\n    return true\n  }\n\n  return false\n}"],"names":[],"mappings":";;;;AAAA;AACA;;;AAOO,MAAM,6BAAqC,CAAC,EAAE,GAAG,EAAE;IACxD,IAAI,CAAC,IAAI,IAAI,EAAE;QACb,OAAO;IACT;IAEA,IAAI,IAAA,+IAAY,EAAC,IAAI,IAAI,GAAG;QAC1B,OAAO;IACT;IAEA,MAAM,uBAAuB,IAAA,0JAAgB,EAAC,IAAI,IAAI,EAAE;IACxD,MAAM,kBAAkB,KAAK,MAAM;IAEnC,IAAI,mBAAmB,qBAAqB,QAAQ,CAAC,kBAAkB;QACrE,OAAO;IACT;IAEA,OAAO;AACT"}},
    {"offset": {"line": 409, "column": 0}, "map": {"version":3,"sources":["file:///Users/stefaniedoll/websites/prepublic/epaper-backend/src/collections/Pages/index.ts"],"sourcesContent":["import type { CollectionConfig } from 'payload'\n\nimport { ensureUniqueSlug } from './hooks/ensureUniqueSlug'\nimport { hasSuperAdminOrAdminAccess } from '@/access/superAdminOrTenantAdmin'\n\nexport const Pages: CollectionConfig = {\n  slug: 'pages',\n  access: {\n    create: hasSuperAdminOrAdminAccess,\n    delete: hasSuperAdminOrAdminAccess,\n    read: () => true,\n    update: hasSuperAdminOrAdminAccess,\n  },\n  admin: {\n    useAsTitle: 'title',\n  },\n  fields: [\n    {\n      name: 'title',\n      type: 'text',\n    },\n    {\n      name: 'slug',\n      type: 'text',\n      defaultValue: 'home',\n      hooks: {\n        beforeValidate: [ensureUniqueSlug],\n      },\n      index: true,\n    },\n  ],\n}\n"],"names":[],"mappings":";;;;AAEA;AACA;;;AAEO,MAAM,QAA0B;IACrC,MAAM;IACN,QAAQ;QACN,QAAQ,wKAA0B;QAClC,QAAQ,wKAA0B;QAClC,MAAM,IAAM;QACZ,QAAQ,wKAA0B;IACpC;IACA,OAAO;QACL,YAAY;IACd;IACA,QAAQ;QACN;YACE,MAAM;YACN,MAAM;QACR;QACA;YACE,MAAM;YACN,MAAM;YACN,cAAc;YACd,OAAO;gBACL,gBAAgB;oBAAC,8KAAgB;iBAAC;YACpC;YACA,OAAO;QACT;KACD;AACH"}},
    {"offset": {"line": 450, "column": 0}, "map": {"version":3,"sources":["file:///Users/stefaniedoll/websites/prepublic/epaper-backend/src/collections/Tenants/access/updateAndDelete.ts"],"sourcesContent":["import { isSuperAdmin } from '@/access/isSuperAdmin'\nimport { getUserTenantIDs } from '@/utilities/getUserTenantIDs'\nimport { Access } from 'payload'\n\nexport const updateAndDeleteAccess: Access = ({ req }) => {\n  if (!req.user) {\n    return false\n  }\n\n  if (isSuperAdmin(req.user)) {\n    return true\n  }\n\n  return {\n    id: {\n      in: getUserTenantIDs(req.user, 'tenant-admin'),\n    },\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAGO,MAAM,wBAAgC,CAAC,EAAE,GAAG,EAAE;IACnD,IAAI,CAAC,IAAI,IAAI,EAAE;QACb,OAAO;IACT;IAEA,IAAI,IAAA,+IAAY,EAAC,IAAI,IAAI,GAAG;QAC1B,OAAO;IACT;IAEA,OAAO;QACL,IAAI;YACF,IAAI,IAAA,0JAAgB,EAAC,IAAI,IAAI,EAAE;QACjC;IACF;AACF"}},
    {"offset": {"line": 475, "column": 0}, "map": {"version":3,"sources":["file:///Users/stefaniedoll/websites/prepublic/epaper-backend/src/collections/Tenants/index.ts"],"sourcesContent":["import type { CollectionConfig } from 'payload'\n\nimport { hasSuperAdminAccess } from '@/access/isSuperAdmin'\nimport { updateAndDeleteAccess } from './access/updateAndDelete'\n\nexport const Tenants: CollectionConfig = {\n  slug: 'tenants',\n  access: {\n    create: hasSuperAdminAccess,\n    delete: updateAndDeleteAccess,\n    read: ({ req }) => Boolean(req.user),\n    update: updateAndDeleteAccess,\n  },\n  admin: {\n    useAsTitle: 'name',\n  },\n  fields: [\n    {\n      name: 'name',\n      type: 'text',\n      required: true,\n    },\n    {\n      name: 'domain',\n      type: 'text',\n      admin: {\n        description: 'Used for domain-based tenant handling',\n      },\n    },\n    {\n      name: 'slug',\n      type: 'text',\n      admin: {\n        description: 'Used for url paths, example: /tenant-slug/page-slug',\n      },\n      index: true,\n      required: true,\n    },\n    {\n      name: 'allowPublicRead',\n      type: 'checkbox',\n      admin: {\n        description:\n          'If checked, logging in is not required to read. Useful for building public pages.',\n        position: 'sidebar',\n      },\n      defaultValue: false,\n      index: true,\n    },\n  ],\n}\n"],"names":[],"mappings":";;;;AAEA;AACA;;;AAEO,MAAM,UAA4B;IACvC,MAAM;IACN,QAAQ;QACN,QAAQ,sJAAmB;QAC3B,QAAQ,qLAAqB;QAC7B,MAAM,CAAC,EAAE,GAAG,EAAE,GAAK,QAAQ,IAAI,IAAI;QACnC,QAAQ,qLAAqB;IAC/B;IACA,OAAO;QACL,YAAY;IACd;IACA,QAAQ;QACN;YACE,MAAM;YACN,MAAM;YACN,UAAU;QACZ;QACA;YACE,MAAM;YACN,MAAM;YACN,OAAO;gBACL,aAAa;YACf;QACF;QACA;YACE,MAAM;YACN,MAAM;YACN,OAAO;gBACL,aAAa;YACf;YACA,OAAO;YACP,UAAU;QACZ;QACA;YACE,MAAM;YACN,MAAM;YACN,OAAO;gBACL,aACE;gBACF,UAAU;YACZ;YACA,cAAc;YACd,OAAO;QACT;KACD;AACH"}},
    {"offset": {"line": 532, "column": 0}, "map": {"version":3,"sources":["file:///Users/stefaniedoll/websites/prepublic/epaper-backend/src/collections/Users/access/create.ts"],"sourcesContent":["import type { Access } from 'payload'\n\nimport type { Tenant, User } from '../../../payload-types'\n\nimport { isSuperAdmin } from '../../../access/isSuperAdmin'\nimport { getUserTenantIDs } from '../../../utilities/getUserTenantIDs'\n\nexport const createAccess: Access<User> = ({ req }) => {\n  if (!req.user) {\n    return false\n  }\n\n  if (isSuperAdmin(req.user)) {\n    return true\n  }\n\n  if (!isSuperAdmin(req.user) && req.data?.roles?.includes('super-admin')) {\n    return false\n  }\n\n  const adminTenantAccessIDs = getUserTenantIDs(req.user, 'tenant-admin')\n\n  const requestedTenants: Tenant['id'][] =\n    req.data?.tenants?.map((t: { tenant: Tenant['id'] }) => t.tenant) ?? []\n\n  const hasAccessToAllRequestedTenants = requestedTenants.every((tenantID) =>\n    adminTenantAccessIDs.includes(tenantID),\n  )\n\n  if (hasAccessToAllRequestedTenants) {\n    return true\n  }\n\n  return false\n}\n"],"names":[],"mappings":";;;;AAIA;AACA;;;AAEO,MAAM,eAA6B,CAAC,EAAE,GAAG,EAAE;IAChD,IAAI,CAAC,IAAI,IAAI,EAAE;QACb,OAAO;IACT;IAEA,IAAI,IAAA,+IAAY,EAAC,IAAI,IAAI,GAAG;QAC1B,OAAO;IACT;IAEA,IAAI,CAAC,IAAA,+IAAY,EAAC,IAAI,IAAI,KAAK,IAAI,IAAI,EAAE,OAAO,SAAS,gBAAgB;QACvE,OAAO;IACT;IAEA,MAAM,uBAAuB,IAAA,0JAAgB,EAAC,IAAI,IAAI,EAAE;IAExD,MAAM,mBACJ,IAAI,IAAI,EAAE,SAAS,IAAI,CAAC,IAAgC,EAAE,MAAM,KAAK,EAAE;IAEzE,MAAM,iCAAiC,iBAAiB,KAAK,CAAC,CAAC,WAC7D,qBAAqB,QAAQ,CAAC;IAGhC,IAAI,gCAAgC;QAClC,OAAO;IACT;IAEA,OAAO;AACT"}},
    {"offset": {"line": 562, "column": 0}, "map": {"version":3,"sources":["file:///Users/stefaniedoll/websites/prepublic/epaper-backend/src/collections/Users/access/isAccessingSelf.ts"],"sourcesContent":["import { User } from '@/payload-types'\n\nexport const isAccessingSelf = ({ id, user }: { user?: User; id?: string | number }): boolean => {\n  return user ? Boolean(user.id === id) : false\n}\n"],"names":[],"mappings":";;;;AAEO,MAAM,kBAAkB,CAAC,EAAE,EAAE,EAAE,IAAI,EAAyC;IACjF,OAAO,OAAO,QAAQ,KAAK,EAAE,KAAK,MAAM;AAC1C"}},
    {"offset": {"line": 573, "column": 0}, "map": {"version":3,"sources":["file:///Users/stefaniedoll/websites/prepublic/epaper-backend/src/utilities/getCollectionIDType.ts"],"sourcesContent":["import type { CollectionSlug, Payload } from 'payload'\n\ntype Args = {\n  collectionSlug: CollectionSlug\n  payload: Payload\n}\nexport const getCollectionIDType = ({ collectionSlug, payload }: Args): 'number' | 'text' => {\n  return payload.collections[collectionSlug]?.customIDType ?? payload.db.defaultIDType\n}\n"],"names":[],"mappings":";;;;AAMO,MAAM,sBAAsB,CAAC,EAAE,cAAc,EAAE,OAAO,EAAQ;IACnE,OAAO,QAAQ,WAAW,CAAC,eAAe,EAAE,gBAAgB,QAAQ,EAAE,CAAC,aAAa;AACtF"}},
    {"offset": {"line": 584, "column": 0}, "map": {"version":3,"sources":["file:///Users/stefaniedoll/websites/prepublic/epaper-backend/src/collections/Users/access/read.ts"],"sourcesContent":["import type { User } from '@/payload-types'\nimport type { Access, Where } from 'payload'\nimport { getTenantFromCookie } from '@payloadcms/plugin-multi-tenant/utilities'\n\nimport { isSuperAdmin } from '../../../access/isSuperAdmin'\nimport { getUserTenantIDs } from '../../../utilities/getUserTenantIDs'\nimport { isAccessingSelf } from './isAccessingSelf'\nimport { getCollectionIDType } from '@/utilities/getCollectionIDType'\n\nexport const readAccess: Access<User> = ({ req, id }) => {\n  if (!req?.user) {\n    return false\n  }\n\n  if (isAccessingSelf({ id, user: req.user })) {\n    return true\n  }\n\n  const superAdmin = isSuperAdmin(req.user)\n  const selectedTenant = getTenantFromCookie(\n    req.headers,\n    getCollectionIDType({ payload: req.payload, collectionSlug: 'tenants' }),\n  )\n  const adminTenantAccessIDs = getUserTenantIDs(req.user, 'tenant-admin')\n\n  if (selectedTenant) {\n    // If it's a super admin, or they have access to the tenant ID set in cookie\n    const hasTenantAccess = adminTenantAccessIDs.some((id) => id === selectedTenant)\n    if (superAdmin || hasTenantAccess) {\n      return {\n        'tenants.tenant': {\n          equals: selectedTenant,\n        },\n      }\n    }\n  }\n\n  if (superAdmin) {\n    return true\n  }\n\n  return {\n    or: [\n      {\n        id: {\n          equals: req.user.id,\n        },\n      },\n      {\n        'tenants.tenant': {\n          in: adminTenantAccessIDs,\n        },\n      },\n    ],\n  } as Where\n}\n"],"names":[],"mappings":";;;;AAEA;AAEA;AACA;AACA;AACA;;;;;;AAEO,MAAM,aAA2B,CAAC,EAAE,GAAG,EAAE,EAAE,EAAE;IAClD,IAAI,CAAC,KAAK,MAAM;QACd,OAAO;IACT;IAEA,IAAI,IAAA,6KAAe,EAAC;QAAE;QAAI,MAAM,IAAI,IAAI;IAAC,IAAI;QAC3C,OAAO;IACT;IAEA,MAAM,aAAa,IAAA,+IAAY,EAAC,IAAI,IAAI;IACxC,MAAM,iBAAiB,IAAA,qaAAmB,EACxC,IAAI,OAAO,EACX,IAAA,gKAAmB,EAAC;QAAE,SAAS,IAAI,OAAO;QAAE,gBAAgB;IAAU;IAExE,MAAM,uBAAuB,IAAA,0JAAgB,EAAC,IAAI,IAAI,EAAE;IAExD,IAAI,gBAAgB;QAClB,4EAA4E;QAC5E,MAAM,kBAAkB,qBAAqB,IAAI,CAAC,CAAC,KAAO,OAAO;QACjE,IAAI,cAAc,iBAAiB;YACjC,OAAO;gBACL,kBAAkB;oBAChB,QAAQ;gBACV;YACF;QACF;IACF;IAEA,IAAI,YAAY;QACd,OAAO;IACT;IAEA,OAAO;QACL,IAAI;YACF;gBACE,IAAI;oBACF,QAAQ,IAAI,IAAI,CAAC,EAAE;gBACrB;YACF;YACA;gBACE,kBAAkB;oBAChB,IAAI;gBACN;YACF;SACD;IACH;AACF"}},
    {"offset": {"line": 647, "column": 0}, "map": {"version":3,"sources":["file:///Users/stefaniedoll/websites/prepublic/epaper-backend/src/collections/Users/access/updateAndDelete.ts"],"sourcesContent":["import type { Access } from 'payload'\n\nimport { getUserTenantIDs } from '../../../utilities/getUserTenantIDs'\nimport { isSuperAdmin } from '@/access/isSuperAdmin'\nimport { isAccessingSelf } from './isAccessingSelf'\n\nexport const updateAndDeleteAccess: Access = ({ req, id }) => {\n  const { user } = req\n\n  if (!user) {\n    return false\n  }\n\n  if (isSuperAdmin(user) || isAccessingSelf({ user, id })) {\n    return true\n  }\n\n  /**\n   * Constrains update and delete access to users that belong\n   * to the same tenant as the tenant-admin making the request\n   *\n   * You may want to take this a step further with a beforeChange\n   * hook to ensure that the a tenant-admin can only remove users\n   * from their own tenant in the tenants array.\n   */\n  return {\n    'tenants.tenant': {\n      in: getUserTenantIDs(user, 'tenant-admin'),\n    },\n  }\n}\n"],"names":[],"mappings":";;;;AAEA;AACA;AACA;;;;AAEO,MAAM,wBAAgC,CAAC,EAAE,GAAG,EAAE,EAAE,EAAE;IACvD,MAAM,EAAE,IAAI,EAAE,GAAG;IAEjB,IAAI,CAAC,MAAM;QACT,OAAO;IACT;IAEA,IAAI,IAAA,+IAAY,EAAC,SAAS,IAAA,6KAAe,EAAC;QAAE;QAAM;IAAG,IAAI;QACvD,OAAO;IACT;IAEA;;;;;;;GAOC,GACD,OAAO;QACL,kBAAkB;YAChB,IAAI,IAAA,0JAAgB,EAAC,MAAM;QAC7B;IACF;AACF"}},
    {"offset": {"line": 757, "column": 0}, "map": {"version":3,"sources":["file:///Users/stefaniedoll/websites/prepublic/epaper-backend/src/collections/Users/endpoints/externalUsersLogin.ts"],"sourcesContent":["import type { Collection, Endpoint } from 'payload'\n\nimport { headersWithCors } from '@payloadcms/next/utilities'\nimport { APIError, generatePayloadCookie } from 'payload'\n\n// A custom endpoint that can be reached by POST request\n// at: /api/users/external-users/login\nexport const externalUsersLogin: Endpoint = {\n  handler: async (req) => {\n    let data: { [key: string]: string } = {}\n\n    try {\n      if (typeof req.json === 'function') {\n        data = await req.json()\n      }\n    } catch (error) {\n      // swallow error, data is already empty object\n    }\n    const { password, tenantSlug, tenantDomain, username } = data\n\n    if (!username || !password) {\n      throw new APIError('Username and Password are required for login.', 400, null, true)\n    }\n\n    const fullTenant = (\n      await req.payload.find({\n        collection: 'tenants',\n        where: tenantDomain\n          ? {\n              domain: {\n                equals: tenantDomain,\n              },\n            }\n          : {\n              slug: {\n                equals: tenantSlug,\n              },\n            },\n      })\n    ).docs[0]\n\n    const foundUser = await req.payload.find({\n      collection: 'users',\n      where: {\n        or: [\n          {\n            and: [\n              {\n                email: {\n                  equals: username,\n                },\n              },\n              {\n                'tenants.tenant': {\n                  equals: fullTenant.id,\n                },\n              },\n            ],\n          },\n          {\n            and: [\n              {\n                username: {\n                  equals: username,\n                },\n              },\n              {\n                'tenants.tenant': {\n                  equals: fullTenant.id,\n                },\n              },\n            ],\n          },\n        ],\n      },\n    })\n\n    if (foundUser.totalDocs > 0) {\n      try {\n        const loginAttempt = await req.payload.login({\n          collection: 'users',\n          data: {\n            email: foundUser.docs[0].email,\n            password,\n          },\n          req,\n        })\n\n        if (loginAttempt?.token) {\n          const collection: Collection = (req.payload.collections as { [key: string]: Collection })[\n            'users'\n          ]\n          const cookie = generatePayloadCookie({\n            collectionAuthConfig: collection.config.auth,\n            cookiePrefix: req.payload.config.cookiePrefix,\n            token: loginAttempt.token,\n          })\n\n          return Response.json(loginAttempt, {\n            headers: headersWithCors({\n              headers: new Headers({\n                'Set-Cookie': cookie,\n              }),\n              req,\n            }),\n            status: 200,\n          })\n        }\n\n        throw new APIError(\n          'Unable to login with the provided username and password.',\n          400,\n          null,\n          true,\n        )\n      } catch (e) {\n        throw new APIError(\n          'Unable to login with the provided username and password.',\n          400,\n          null,\n          true,\n        )\n      }\n    }\n\n    throw new APIError('Unable to login with the provided username and password.', 400, null, true)\n  },\n  method: 'post',\n  path: '/external-users/login',\n}\n"],"names":[],"mappings":";;;;AAEA;AACA;AAAA;;;AAIO,MAAM,qBAA+B;IAC1C,SAAS,OAAO;QACd,IAAI,OAAkC,CAAC;QAEvC,IAAI;YACF,IAAI,OAAO,IAAI,IAAI,KAAK,YAAY;gBAClC,OAAO,MAAM,IAAI,IAAI;YACvB;QACF,EAAE,OAAO,OAAO;QACd,8CAA8C;QAChD;QACA,MAAM,EAAE,QAAQ,EAAE,UAAU,EAAE,YAAY,EAAE,QAAQ,EAAE,GAAG;QAEzD,IAAI,CAAC,YAAY,CAAC,UAAU;YAC1B,MAAM,IAAI,2QAAQ,CAAC,iDAAiD,KAAK,MAAM;QACjF;QAEA,MAAM,aAAa,CACjB,MAAM,IAAI,OAAO,CAAC,IAAI,CAAC;YACrB,YAAY;YACZ,OAAO,eACH;gBACE,QAAQ;oBACN,QAAQ;gBACV;YACF,IACA;gBACE,MAAM;oBACJ,QAAQ;gBACV;YACF;QACN,EACF,EAAE,IAAI,CAAC,EAAE;QAET,MAAM,YAAY,MAAM,IAAI,OAAO,CAAC,IAAI,CAAC;YACvC,YAAY;YACZ,OAAO;gBACL,IAAI;oBACF;wBACE,KAAK;4BACH;gCACE,OAAO;oCACL,QAAQ;gCACV;4BACF;4BACA;gCACE,kBAAkB;oCAChB,QAAQ,WAAW,EAAE;gCACvB;4BACF;yBACD;oBACH;oBACA;wBACE,KAAK;4BACH;gCACE,UAAU;oCACR,QAAQ;gCACV;4BACF;4BACA;gCACE,kBAAkB;oCAChB,QAAQ,WAAW,EAAE;gCACvB;4BACF;yBACD;oBACH;iBACD;YACH;QACF;QAEA,IAAI,UAAU,SAAS,GAAG,GAAG;YAC3B,IAAI;gBACF,MAAM,eAAe,MAAM,IAAI,OAAO,CAAC,KAAK,CAAC;oBAC3C,YAAY;oBACZ,MAAM;wBACJ,OAAO,UAAU,IAAI,CAAC,EAAE,CAAC,KAAK;wBAC9B;oBACF;oBACA;gBACF;gBAEA,IAAI,cAAc,OAAO;oBACvB,MAAM,aAAyB,AAAC,IAAI,OAAO,CAAC,WAAW,AAAkC,CACvF,QACD;oBACD,MAAM,SAAS,IAAA,qRAAqB,EAAC;wBACnC,sBAAsB,WAAW,MAAM,CAAC,IAAI;wBAC5C,cAAc,IAAI,OAAO,CAAC,MAAM,CAAC,YAAY;wBAC7C,OAAO,aAAa,KAAK;oBAC3B;oBAEA,OAAO,SAAS,IAAI,CAAC,cAAc;wBACjC,SAAS,IAAA,mZAAe,EAAC;4BACvB,SAAS,IAAI,QAAQ;gCACnB,cAAc;4BAChB;4BACA;wBACF;wBACA,QAAQ;oBACV;gBACF;gBAEA,MAAM,IAAI,2QAAQ,CAChB,4DACA,KACA,MACA;YAEJ,EAAE,OAAO,GAAG;gBACV,MAAM,IAAI,2QAAQ,CAChB,4DACA,KACA,MACA;YAEJ;QACF;QAEA,MAAM,IAAI,2QAAQ,CAAC,4DAA4D,KAAK,MAAM;IAC5F;IACA,QAAQ;IACR,MAAM;AACR"}},
    {"offset": {"line": 868, "column": 0}, "map": {"version":3,"sources":["file:///Users/stefaniedoll/websites/prepublic/epaper-backend/src/collections/Users/hooks/ensureUniqueUsername.ts"],"sourcesContent":["import type { FieldHook, Where } from 'payload'\n\nimport { ValidationError } from 'payload'\n\nimport { getUserTenantIDs } from '../../../utilities/getUserTenantIDs'\nimport { extractID } from '@/utilities/extractID'\nimport { getTenantFromCookie } from '@payloadcms/plugin-multi-tenant/utilities'\nimport { getCollectionIDType } from '@/utilities/getCollectionIDType'\n\nexport const ensureUniqueUsername: FieldHook = async ({ data, originalDoc, req, value }) => {\n  // if value is unchanged, skip validation\n  if (originalDoc.username === value) {\n    return value\n  }\n\n  const constraints: Where[] = [\n    {\n      username: {\n        equals: value,\n      },\n    },\n  ]\n\n  const selectedTenant = getTenantFromCookie(\n    req.headers,\n    getCollectionIDType({ payload: req.payload, collectionSlug: 'tenants' }),\n  )\n\n  if (selectedTenant) {\n    constraints.push({\n      'tenants.tenant': {\n        equals: selectedTenant,\n      },\n    })\n  }\n\n  const findDuplicateUsers = await req.payload.find({\n    collection: 'users',\n    where: {\n      and: constraints,\n    },\n  })\n\n  if (findDuplicateUsers.docs.length > 0 && req.user) {\n    const tenantIDs = getUserTenantIDs(req.user)\n    // if the user is an admin or has access to more than 1 tenant\n    // provide a more specific error message\n    if (req.user.roles?.includes('super-admin') || tenantIDs.length > 1) {\n      const attemptedTenantChange = await req.payload.findByID({\n        // @ts-ignore - selectedTenant will match DB ID type\n        id: selectedTenant,\n        collection: 'tenants',\n      })\n\n      throw new ValidationError({\n        errors: [\n          {\n            message: `The \"${attemptedTenantChange.name}\" tenant already has a user with the username \"${value}\". Usernames must be unique per tenant.`,\n            path: 'username',\n          },\n        ],\n      })\n    }\n\n    throw new ValidationError({\n      errors: [\n        {\n          message: `A user with the username ${value} already exists. Usernames must be unique per tenant.`,\n          path: 'username',\n        },\n      ],\n    })\n  }\n\n  return value\n}\n"],"names":[],"mappings":";;;;AAEA;AAEA;AAEA;AACA;;;;;AAEO,MAAM,uBAAkC,OAAO,EAAE,IAAI,EAAE,WAAW,EAAE,GAAG,EAAE,KAAK,EAAE;IACrF,yCAAyC;IACzC,IAAI,YAAY,QAAQ,KAAK,OAAO;QAClC,OAAO;IACT;IAEA,MAAM,cAAuB;QAC3B;YACE,UAAU;gBACR,QAAQ;YACV;QACF;KACD;IAED,MAAM,iBAAiB,IAAA,qaAAmB,EACxC,IAAI,OAAO,EACX,IAAA,gKAAmB,EAAC;QAAE,SAAS,IAAI,OAAO;QAAE,gBAAgB;IAAU;IAGxE,IAAI,gBAAgB;QAClB,YAAY,IAAI,CAAC;YACf,kBAAkB;gBAChB,QAAQ;YACV;QACF;IACF;IAEA,MAAM,qBAAqB,MAAM,IAAI,OAAO,CAAC,IAAI,CAAC;QAChD,YAAY;QACZ,OAAO;YACL,KAAK;QACP;IACF;IAEA,IAAI,mBAAmB,IAAI,CAAC,MAAM,GAAG,KAAK,IAAI,IAAI,EAAE;QAClD,MAAM,YAAY,IAAA,0JAAgB,EAAC,IAAI,IAAI;QAC3C,8DAA8D;QAC9D,wCAAwC;QACxC,IAAI,IAAI,IAAI,CAAC,KAAK,EAAE,SAAS,kBAAkB,UAAU,MAAM,GAAG,GAAG;YACnE,MAAM,wBAAwB,MAAM,IAAI,OAAO,CAAC,QAAQ,CAAC;gBACvD,oDAAoD;gBACpD,IAAI;gBACJ,YAAY;YACd;YAEA,MAAM,IAAI,yRAAe,CAAC;gBACxB,QAAQ;oBACN;wBACE,SAAS,CAAC,KAAK,EAAE,sBAAsB,IAAI,CAAC,+CAA+C,EAAE,MAAM,uCAAuC,CAAC;wBAC3I,MAAM;oBACR;iBACD;YACH;QACF;QAEA,MAAM,IAAI,yRAAe,CAAC;YACxB,QAAQ;gBACN;oBACE,SAAS,CAAC,yBAAyB,EAAE,MAAM,qDAAqD,CAAC;oBACjG,MAAM;gBACR;aACD;QACH;IACF;IAEA,OAAO;AACT"}},
    {"offset": {"line": 943, "column": 0}, "map": {"version":3,"sources":["file:///Users/stefaniedoll/websites/prepublic/epaper-backend/src/collections/Users/hooks/setCookieBasedOnDomain.ts"],"sourcesContent":["import type { CollectionAfterLoginHook } from 'payload'\n\nimport { mergeHeaders, generateCookie, getCookieExpiration } from 'payload'\n\nexport const setCookieBasedOnDomain: CollectionAfterLoginHook = async ({ req, user }) => {\n  const relatedOrg = await req.payload.find({\n    collection: 'tenants',\n    depth: 0,\n    limit: 1,\n    where: {\n      domain: {\n        equals: req.headers.get('host'),\n      },\n    },\n  })\n\n  // If a matching tenant is found, set the 'payload-tenant' cookie\n  if (relatedOrg && relatedOrg.docs.length > 0) {\n    const tenantCookie = generateCookie({\n      name: 'payload-tenant',\n      expires: getCookieExpiration({ seconds: 7200 }),\n      path: '/',\n      returnCookieAsObject: false,\n      value: String(relatedOrg.docs[0].id),\n    })\n\n    // Merge existing responseHeaders with the new Set-Cookie header\n    const newHeaders = new Headers({\n      'Set-Cookie': tenantCookie as string,\n    })\n\n    // Ensure you merge existing response headers if they already exist\n    req.responseHeaders = req.responseHeaders\n      ? mergeHeaders(req.responseHeaders, newHeaders)\n      : newHeaders\n  }\n\n  return user\n}\n"],"names":[],"mappings":";;;;AAEA;AAAA;;AAEO,MAAM,yBAAmD,OAAO,EAAE,GAAG,EAAE,IAAI,EAAE;IAClF,MAAM,aAAa,MAAM,IAAI,OAAO,CAAC,IAAI,CAAC;QACxC,YAAY;QACZ,OAAO;QACP,OAAO;QACP,OAAO;YACL,QAAQ;gBACN,QAAQ,IAAI,OAAO,CAAC,GAAG,CAAC;YAC1B;QACF;IACF;IAEA,iEAAiE;IACjE,IAAI,cAAc,WAAW,IAAI,CAAC,MAAM,GAAG,GAAG;QAC5C,MAAM,eAAe,IAAA,8QAAc,EAAC;YAClC,MAAM;YACN,SAAS,IAAA,mRAAmB,EAAC;gBAAE,SAAS;YAAK;YAC7C,MAAM;YACN,sBAAsB;YACtB,OAAO,OAAO,WAAW,IAAI,CAAC,EAAE,CAAC,EAAE;QACrC;QAEA,gEAAgE;QAChE,MAAM,aAAa,IAAI,QAAQ;YAC7B,cAAc;QAChB;QAEA,mEAAmE;QACnE,IAAI,eAAe,GAAG,IAAI,eAAe,GACrC,IAAA,sRAAY,EAAC,IAAI,eAAe,EAAE,cAClC;IACN;IAEA,OAAO;AACT"}},
    {"offset": {"line": 985, "column": 0}, "map": {"version":3,"sources":["file:///Users/stefaniedoll/websites/prepublic/epaper-backend/src/collections/Users/index.ts"],"sourcesContent":["import type { CollectionConfig } from 'payload'\n\nimport { createAccess } from './access/create'\nimport { readAccess } from './access/read'\nimport { updateAndDeleteAccess } from './access/updateAndDelete'\nimport { externalUsersLogin } from './endpoints/externalUsersLogin'\nimport { ensureUniqueUsername } from './hooks/ensureUniqueUsername'\nimport { isSuperAdmin } from '@/access/isSuperAdmin'\nimport { setCookieBasedOnDomain } from './hooks/setCookieBasedOnDomain'\nimport { tenantsArrayField } from '@payloadcms/plugin-multi-tenant/fields'\n\nconst defaultTenantArrayField = tenantsArrayField({\n  tenantsArrayFieldName: 'tenants',\n  tenantsArrayTenantFieldName: 'tenant',\n  tenantsCollectionSlug: 'tenants',\n  arrayFieldAccess: {},\n  tenantFieldAccess: {},\n  rowFields: [\n    {\n      name: 'roles',\n      type: 'select',\n      defaultValue: ['tenant-viewer'],\n      hasMany: true,\n      options: ['tenant-admin', 'tenant-viewer'],\n      required: true,\n      access: {\n        update: ({ req }) => {\n          const { user } = req\n          if (!user) {\n            return false\n          }\n\n          if (isSuperAdmin(user)) {\n            return true\n          }\n\n          return true\n        },\n      },\n    },\n  ],\n})\n\nconst Users: CollectionConfig = {\n  slug: 'users',\n  access: {\n    create: createAccess,\n    delete: updateAndDeleteAccess,\n    read: readAccess,\n    update: updateAndDeleteAccess,\n  },\n  admin: {\n    useAsTitle: 'email',\n  },\n  auth: true,\n  endpoints: [externalUsersLogin],\n  fields: [\n    {\n      type: 'text',\n      name: 'password',\n      hidden: true,\n      access: {\n        read: () => false, // Hide password field from read access\n        update: ({ req, id }) => {\n          const { user } = req\n          if (!user) {\n            return false\n          }\n\n          if (id === user.id) {\n            // Allow user to update their own password\n            return true\n          }\n\n          return isSuperAdmin(user)\n        },\n      },\n    },\n    {\n      admin: {\n        position: 'sidebar',\n      },\n      name: 'roles',\n      type: 'select',\n      defaultValue: ['user'],\n      hasMany: true,\n      options: ['super-admin', 'user'],\n      access: {\n        update: ({ req }) => {\n          return isSuperAdmin(req.user)\n        },\n      },\n    },\n    {\n      name: 'username',\n      type: 'text',\n      hooks: {\n        beforeValidate: [ensureUniqueUsername],\n      },\n      index: true,\n    },\n    {\n      ...defaultTenantArrayField,\n      admin: {\n        ...(defaultTenantArrayField?.admin || {}),\n        position: 'sidebar',\n      },\n    },\n  ],\n  // The following hook sets a cookie based on the domain a user logs in from.\n  // It checks the domain and matches it to a tenant in the system, then sets\n  // a 'payload-tenant' cookie for that tenant.\n\n  hooks: {\n    afterLogin: [setCookieBasedOnDomain],\n  },\n}\n\nexport default Users\n"],"names":[],"mappings":";;;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;AAEA,MAAM,0BAA0B,IAAA,uaAAiB,EAAC;IAChD,uBAAuB;IACvB,6BAA6B;IAC7B,uBAAuB;IACvB,kBAAkB,CAAC;IACnB,mBAAmB,CAAC;IACpB,WAAW;QACT;YACE,MAAM;YACN,MAAM;YACN,cAAc;gBAAC;aAAgB;YAC/B,SAAS;YACT,SAAS;gBAAC;gBAAgB;aAAgB;YAC1C,UAAU;YACV,QAAQ;gBACN,QAAQ,CAAC,EAAE,GAAG,EAAE;oBACd,MAAM,EAAE,IAAI,EAAE,GAAG;oBACjB,IAAI,CAAC,MAAM;wBACT,OAAO;oBACT;oBAEA,IAAI,IAAA,+IAAY,EAAC,OAAO;wBACtB,OAAO;oBACT;oBAEA,OAAO;gBACT;YACF;QACF;KACD;AACH;AAEA,MAAM,QAA0B;IAC9B,MAAM;IACN,QAAQ;QACN,QAAQ,iKAAY;QACpB,QAAQ,mLAAqB;QAC7B,MAAM,6JAAU;QAChB,QAAQ,mLAAqB;IAC/B;IACA,OAAO;QACL,YAAY;IACd;IACA,MAAM;IACN,WAAW;QAAC,sLAAkB;KAAC;IAC/B,QAAQ;QACN;YACE,MAAM;YACN,MAAM;YACN,QAAQ;YACR,QAAQ;gBACN,MAAM,IAAM;gBACZ,QAAQ,CAAC,EAAE,GAAG,EAAE,EAAE,EAAE;oBAClB,MAAM,EAAE,IAAI,EAAE,GAAG;oBACjB,IAAI,CAAC,MAAM;wBACT,OAAO;oBACT;oBAEA,IAAI,OAAO,KAAK,EAAE,EAAE;wBAClB,0CAA0C;wBAC1C,OAAO;oBACT;oBAEA,OAAO,IAAA,+IAAY,EAAC;gBACtB;YACF;QACF;QACA;YACE,OAAO;gBACL,UAAU;YACZ;YACA,MAAM;YACN,MAAM;YACN,cAAc;gBAAC;aAAO;YACtB,SAAS;YACT,SAAS;gBAAC;gBAAe;aAAO;YAChC,QAAQ;gBACN,QAAQ,CAAC,EAAE,GAAG,EAAE;oBACd,OAAO,IAAA,+IAAY,EAAC,IAAI,IAAI;gBAC9B;YACF;QACF;QACA;YACE,MAAM;YACN,MAAM;YACN,OAAO;gBACL,gBAAgB;oBAAC,sLAAoB;iBAAC;YACxC;YACA,OAAO;QACT;QACA;YACE,GAAG,uBAAuB;YAC1B,OAAO;gBACL,GAAI,yBAAyB,SAAS,CAAC,CAAC;gBACxC,UAAU;YACZ;QACF;KACD;IACD,4EAA4E;IAC5E,2EAA2E;IAC3E,6CAA6C;IAE7C,OAAO;QACL,YAAY;YAAC,0LAAsB;SAAC;IACtC;AACF;uCAEe"}},
    {"offset": {"line": 1126, "column": 0}, "map": {"version":3,"sources":["file:///Users/stefaniedoll/websites/prepublic/epaper-backend/src/utilities/deepMerge.ts"],"sourcesContent":["// eslint-disable-next-line @typescript-eslint/ban-ts-comment\n// @ts-nocheck\n\n/**\n * Simple object check.\n * @param item\n * @returns {boolean}\n */\nexport function isObject(item: unknown): item is object {\n  return typeof item === 'object' && !Array.isArray(item)\n}\n\n/**\n * Deep merge two objects.\n * @param target\n * @param ...sources\n */\nexport default function deepMerge<T, R>(target: T, source: R): T {\n  const output = { ...target }\n  if (isObject(target) && isObject(source)) {\n    Object.keys(source).forEach((key) => {\n      if (isObject(source[key])) {\n        if (!(key in target)) {\n          Object.assign(output, { [key]: source[key] })\n        } else {\n          output[key] = deepMerge(target[key], source[key])\n        }\n      } else {\n        Object.assign(output, { [key]: source[key] })\n      }\n    })\n  }\n\n  return output\n}\n"],"names":[],"mappings":"AAAA,6DAA6D;AAC7D,cAAc;AAEd;;;;CAIC;;;;;;AACM,SAAS,SAAS,IAAa;IACpC,OAAO,OAAO,SAAS,YAAY,CAAC,MAAM,OAAO,CAAC;AACpD;AAOe,SAAS,UAAgB,MAAS,EAAE,MAAS;IAC1D,MAAM,SAAS;QAAE,GAAG,MAAM;IAAC;IAC3B,IAAI,SAAS,WAAW,SAAS,SAAS;QACxC,OAAO,IAAI,CAAC,QAAQ,OAAO,CAAC,CAAC;YAC3B,IAAI,SAAS,MAAM,CAAC,IAAI,GAAG;gBACzB,IAAI,CAAC,CAAC,OAAO,MAAM,GAAG;oBACpB,OAAO,MAAM,CAAC,QAAQ;wBAAE,CAAC,IAAI,EAAE,MAAM,CAAC,IAAI;oBAAC;gBAC7C,OAAO;oBACL,MAAM,CAAC,IAAI,GAAG,UAAU,MAAM,CAAC,IAAI,EAAE,MAAM,CAAC,IAAI;gBAClD;YACF,OAAO;gBACL,OAAO,MAAM,CAAC,QAAQ;oBAAE,CAAC,IAAI,EAAE,MAAM,CAAC,IAAI;gBAAC;YAC7C;QACF;IACF;IAEA,OAAO;AACT"}},
    {"offset": {"line": 1168, "column": 0}, "map": {"version":3,"sources":["file:///Users/stefaniedoll/websites/prepublic/epaper-backend/src/fields/link.ts"],"sourcesContent":["import type { Field, GroupField } from 'payload'\n\nimport deepMerge from '@/utilities/deepMerge'\n\nexport type LinkAppearances = 'default' | 'outline'\n\nexport const appearanceOptions: Record<LinkAppearances, { label: string; value: string }> = {\n  default: {\n    label: 'Default',\n    value: 'default',\n  },\n  outline: {\n    label: 'Outline',\n    value: 'outline',\n  },\n}\n\ntype LinkType = (options?: {\n  appearances?: LinkAppearances[] | false\n  disableLabel?: boolean\n  overrides?: Partial<GroupField>\n}) => Field\n\nexport const link: LinkType = ({ appearances, disableLabel = false, overrides = {} } = {}) => {\n  const linkResult: GroupField = {\n    name: 'link',\n    type: 'group',\n    admin: {\n      hideGutter: true,\n    },\n    fields: [\n      {\n        type: 'row',\n        fields: [\n          {\n            name: 'type',\n            type: 'radio',\n            admin: {\n              layout: 'horizontal',\n              width: '50%',\n            },\n            defaultValue: 'reference',\n            options: [\n              {\n                label: 'Internal link',\n                value: 'reference',\n              },\n              {\n                label: 'Custom URL',\n                value: 'custom',\n              },\n            ],\n          },\n          {\n            name: 'newTab',\n            type: 'checkbox',\n            admin: {\n              style: {\n                alignSelf: 'flex-end',\n              },\n              width: '50%',\n            },\n            label: 'Open in new tab',\n          },\n        ],\n      },\n    ],\n  }\n\n  const linkTypes: Field[] = [\n    {\n      name: 'reference',\n      type: 'relationship',\n      admin: {\n        condition: (_, siblingData) => siblingData?.type === 'reference',\n      },\n      label: 'Document to link to',\n      relationTo: ['pages'],\n      required: true,\n    },\n    {\n      name: 'url',\n      type: 'text',\n      admin: {\n        condition: (_, siblingData) => siblingData?.type === 'custom',\n      },\n      label: 'Custom URL',\n      required: true,\n    },\n  ]\n\n  if (!disableLabel) {\n    linkTypes.map((linkType) => ({\n      ...linkType,\n      admin: {\n        ...linkType.admin,\n        width: '50%',\n      },\n    }))\n\n    linkResult.fields.push({\n      type: 'row',\n      fields: [\n        ...linkTypes,\n        {\n          name: 'label',\n          type: 'text',\n          admin: {\n            width: '50%',\n          },\n          label: 'Label',\n          required: true,\n        },\n      ],\n    })\n  } else {\n    linkResult.fields = [...linkResult.fields, ...linkTypes]\n  }\n\n  if (appearances !== false) {\n    let appearanceOptionsToUse = [appearanceOptions.default, appearanceOptions.outline]\n\n    if (appearances) {\n      appearanceOptionsToUse = appearances.map((appearance) => appearanceOptions[appearance])\n    }\n\n    linkResult.fields.push({\n      name: 'appearance',\n      type: 'select',\n      admin: {\n        description: 'Choose how the link should be rendered.',\n      },\n      defaultValue: 'default',\n      options: appearanceOptionsToUse,\n    })\n  }\n\n  return deepMerge(linkResult, overrides)\n}\n"],"names":[],"mappings":";;;;;;AAEA;;AAIO,MAAM,oBAA+E;IAC1F,SAAS;QACP,OAAO;QACP,OAAO;IACT;IACA,SAAS;QACP,OAAO;QACP,OAAO;IACT;AACF;AAQO,MAAM,OAAiB,CAAC,EAAE,WAAW,EAAE,eAAe,KAAK,EAAE,YAAY,CAAC,CAAC,EAAE,GAAG,CAAC,CAAC;IACvF,MAAM,aAAyB;QAC7B,MAAM;QACN,MAAM;QACN,OAAO;YACL,YAAY;QACd;QACA,QAAQ;YACN;gBACE,MAAM;gBACN,QAAQ;oBACN;wBACE,MAAM;wBACN,MAAM;wBACN,OAAO;4BACL,QAAQ;4BACR,OAAO;wBACT;wBACA,cAAc;wBACd,SAAS;4BACP;gCACE,OAAO;gCACP,OAAO;4BACT;4BACA;gCACE,OAAO;gCACP,OAAO;4BACT;yBACD;oBACH;oBACA;wBACE,MAAM;wBACN,MAAM;wBACN,OAAO;4BACL,OAAO;gCACL,WAAW;4BACb;4BACA,OAAO;wBACT;wBACA,OAAO;oBACT;iBACD;YACH;SACD;IACH;IAEA,MAAM,YAAqB;QACzB;YACE,MAAM;YACN,MAAM;YACN,OAAO;gBACL,WAAW,CAAC,GAAG,cAAgB,aAAa,SAAS;YACvD;YACA,OAAO;YACP,YAAY;gBAAC;aAAQ;YACrB,UAAU;QACZ;QACA;YACE,MAAM;YACN,MAAM;YACN,OAAO;gBACL,WAAW,CAAC,GAAG,cAAgB,aAAa,SAAS;YACvD;YACA,OAAO;YACP,UAAU;QACZ;KACD;IAED,IAAI,CAAC,cAAc;QACjB,UAAU,GAAG,CAAC,CAAC,WAAa,CAAC;gBAC3B,GAAG,QAAQ;gBACX,OAAO;oBACL,GAAG,SAAS,KAAK;oBACjB,OAAO;gBACT;YACF,CAAC;QAED,WAAW,MAAM,CAAC,IAAI,CAAC;YACrB,MAAM;YACN,QAAQ;mBACH;gBACH;oBACE,MAAM;oBACN,MAAM;oBACN,OAAO;wBACL,OAAO;oBACT;oBACA,OAAO;oBACP,UAAU;gBACZ;aACD;QACH;IACF,OAAO;QACL,WAAW,MAAM,GAAG;eAAI,WAAW,MAAM;eAAK;SAAU;IAC1D;IAEA,IAAI,gBAAgB,OAAO;QACzB,IAAI,yBAAyB;YAAC,kBAAkB,OAAO;YAAE,kBAAkB,OAAO;SAAC;QAEnF,IAAI,aAAa;YACf,yBAAyB,YAAY,GAAG,CAAC,CAAC,aAAe,iBAAiB,CAAC,WAAW;QACxF;QAEA,WAAW,MAAM,CAAC,IAAI,CAAC;YACrB,MAAM;YACN,MAAM;YACN,OAAO;gBACL,aAAa;YACf;YACA,cAAc;YACd,SAAS;QACX;IACF;IAEA,OAAO,IAAA,0IAAS,EAAC,YAAY;AAC/B"}},
    {"offset": {"line": 1307, "column": 0}, "map": {"version":3,"sources":["file:///Users/stefaniedoll/websites/prepublic/epaper-backend/src/Footer/hooks/revalidateFooter.ts"],"sourcesContent":["import type { GlobalAfterChangeHook } from 'payload'\n\nimport { revalidateTag } from 'next/cache'\n\nexport const revalidateFooter: GlobalAfterChangeHook = ({ doc, req: { payload, context } }) => {\n  if (!context.disableRevalidate) {\n    payload.logger.info(`Revalidating footer`)\n\n    revalidateTag('global_footer')\n  }\n\n  return doc\n}\n"],"names":[],"mappings":";;;;AAEA;;AAEO,MAAM,mBAA0C,CAAC,EAAE,GAAG,EAAE,KAAK,EAAE,OAAO,EAAE,OAAO,EAAE,EAAE;IACxF,IAAI,CAAC,QAAQ,iBAAiB,EAAE;QAC9B,QAAQ,MAAM,CAAC,IAAI,CAAC,CAAC,mBAAmB,CAAC;QAEzC,IAAA,mTAAa,EAAC;IAChB;IAEA,OAAO;AACT"}},
    {"offset": {"line": 1324, "column": 0}, "map": {"version":3,"sources":["file:///Users/stefaniedoll/websites/prepublic/epaper-backend/src/Footer/config.ts"],"sourcesContent":["import type { GlobalConfig } from 'payload'\n\nimport { link } from '@/fields/link'\nimport { revalidateFooter } from './hooks/revalidateFooter'\n\nexport const Footer: GlobalConfig = {\n  slug: 'footer',\n  access: {\n    read: () => true,\n  },\n  fields: [\n    {\n      name: 'navItems',\n      type: 'array',\n      fields: [\n        link({\n          appearances: false,\n        }),\n      ],\n      maxRows: 6,\n      admin: {\n        initCollapsed: true,\n        components: {\n          RowLabel: '@/Footer/RowLabel#RowLabel',\n        },\n      },\n    },\n  ],\n  hooks: {\n    afterChange: [revalidateFooter],\n  },\n}\n"],"names":[],"mappings":";;;;AAEA;AACA;;;AAEO,MAAM,SAAuB;IAClC,MAAM;IACN,QAAQ;QACN,MAAM,IAAM;IACd;IACA,QAAQ;QACN;YACE,MAAM;YACN,MAAM;YACN,QAAQ;gBACN,IAAA,+HAAI,EAAC;oBACH,aAAa;gBACf;aACD;YACD,SAAS;YACT,OAAO;gBACL,eAAe;gBACf,YAAY;oBACV,UAAU;gBACZ;YACF;QACF;KACD;IACD,OAAO;QACL,aAAa;YAAC,gKAAgB;SAAC;IACjC;AACF"}},
    {"offset": {"line": 1365, "column": 0}, "map": {"version":3,"sources":["file:///Users/stefaniedoll/websites/prepublic/epaper-backend/src/Header/hooks/revalidateHeader.ts"],"sourcesContent":["import type { GlobalAfterChangeHook } from 'payload'\n\nimport { revalidateTag } from 'next/cache'\n\nexport const revalidateHeader: GlobalAfterChangeHook = ({ doc, req: { payload, context } }) => {\n  if (!context.disableRevalidate) {\n    payload.logger.info(`Revalidating header`)\n\n    revalidateTag('global_header')\n  }\n\n  return doc\n}\n"],"names":[],"mappings":";;;;AAEA;;AAEO,MAAM,mBAA0C,CAAC,EAAE,GAAG,EAAE,KAAK,EAAE,OAAO,EAAE,OAAO,EAAE,EAAE;IACxF,IAAI,CAAC,QAAQ,iBAAiB,EAAE;QAC9B,QAAQ,MAAM,CAAC,IAAI,CAAC,CAAC,mBAAmB,CAAC;QAEzC,IAAA,mTAAa,EAAC;IAChB;IAEA,OAAO;AACT"}},
    {"offset": {"line": 1382, "column": 0}, "map": {"version":3,"sources":["file:///Users/stefaniedoll/websites/prepublic/epaper-backend/src/Header/config.ts"],"sourcesContent":["import type { GlobalConfig } from 'payload'\n\nimport { link } from '@/fields/link'\nimport { revalidateHeader } from './hooks/revalidateHeader'\n\nexport const Header: GlobalConfig = {\n  slug: 'header',\n  access: {\n    read: () => true,\n  },\n  fields: [\n    {\n      name: 'navItems',\n      type: 'array',\n      fields: [\n        link({\n          appearances: false,\n        }),\n      ],\n      maxRows: 6,\n      admin: {\n        initCollapsed: true,\n        components: {\n          RowLabel: '@/Header/RowLabel#RowLabel',\n        },\n      },\n    },\n  ],\n  hooks: {\n    afterChange: [revalidateHeader],\n  },\n}\n"],"names":[],"mappings":";;;;AAEA;AACA;;;AAEO,MAAM,SAAuB;IAClC,MAAM;IACN,QAAQ;QACN,MAAM,IAAM;IACd;IACA,QAAQ;QACN;YACE,MAAM;YACN,MAAM;YACN,QAAQ;gBACN,IAAA,+HAAI,EAAC;oBACH,aAAa;gBACf;aACD;YACD,SAAS;YACT,OAAO;gBACL,eAAe;gBACf,YAAY;oBACV,UAAU;gBACZ;YACF;QACF;KACD;IACD,OAAO;QACL,aAAa;YAAC,gKAAgB;SAAC;IACjC;AACF"}},
    {"offset": {"line": 1425, "column": 0}, "map": {"version":3,"sources":["file:///Users/stefaniedoll/websites/prepublic/epaper-backend/src/payload.config.ts"],"sourcesContent":["import { mongooseAdapter } from '@payloadcms/db-mongodb'\nimport { postgresAdapter } from '@payloadcms/db-postgres'\nimport { lexicalEditor } from '@payloadcms/richtext-lexical'\nimport path from 'path'\nimport { buildConfig } from 'payload'\nimport { fileURLToPath } from 'url'\n\nimport { Pages } from './collections/Pages'\nimport { Tenants } from './collections/Tenants'\nimport Users from './collections/Users'\nimport { Media } from './collections/Media'\nimport { Footer } from './Footer/config'\nimport { Header } from './Header/config'\nimport { multiTenantPlugin } from '@payloadcms/plugin-multi-tenant'\nimport { isSuperAdmin } from './access/isSuperAdmin'\nimport type { Config } from './payload-types'\nimport { getUserTenantIDs } from './utilities/getUserTenantIDs'\nimport { seed } from './seed'\n\nconst filename = fileURLToPath(import.meta.url)\nconst dirname = path.dirname(filename)\n\n// eslint-disable-next-line no-restricted-exports\nexport default buildConfig({\n  admin: {\n    user: 'users',\n  },\n  globals: [Header, Footer],\n  collections: [Pages, Users, Tenants],\n  // db: mongooseAdapter({\n  //   url: process.env.DATABASE_URI as string,\n  // }),\n  db: postgresAdapter({\n    pool: {\n      connectionString: process.env.POSTGRES_URL,\n    },\n  }),\n  // onInit: async (args) => {\n  //   if (process.env.SEED_DB) {\n  //     await seed(args)\n  //   }\n  // },\n  editor: lexicalEditor({}),\n  graphQL: {\n    schemaOutputFile: path.resolve(dirname, 'generated-schema.graphql'),\n  },\n  secret: process.env.PAYLOAD_SECRET as string,\n  typescript: {\n    outputFile: path.resolve(dirname, 'payload-types.ts'),\n  },\n  plugins: [\n    multiTenantPlugin<Config>({\n      cleanupAfterTenantDelete: false,\n      collections: {\n        pages: {},\n        media: {},\n      },\n      tenantField: {\n        access: {\n          read: () => true,\n          update: ({ req }) => {\n            if (isSuperAdmin(req.user)) {\n              return true\n            }\n            return getUserTenantIDs(req.user).length > 0\n          },\n        },\n      },\n      tenantsArrayField: {\n        includeDefaultField: false,\n      },\n      userHasAccessToAllTenants: (user) => isSuperAdmin(user),\n    }),\n  ],\n})\n"],"names":[],"mappings":";;;;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAEA;AACA;AACA;AACA;AAEA;;;;;;;;;;;;;;;;;;;;;;;AAGA,MAAM,WAAW,IAAA,gHAAa,EAAC,8BAAY,GAAG;AAC9C,MAAM,UAAU,4GAAI,CAAC,OAAO,CAAC;uCAGd,IAAA,2QAAW,EAAC;IACzB,OAAO;QACL,MAAM;IACR;IACA,SAAS;QAAC,mIAAM;QAAE,mIAAM;KAAC;IACzB,aAAa;QAAC,+IAAK;QAAE,iJAAK;QAAE,mJAAO;KAAC;IACpC,wBAAwB;IACxB,6CAA6C;IAC7C,MAAM;IACN,IAAI,IAAA,+KAAe,EAAC;QAClB,MAAM;YACJ,kBAAkB,QAAQ,GAAG,CAAC,YAAY;QAC5C;IACF;IACA,4BAA4B;IAC5B,+BAA+B;IAC/B,uBAAuB;IACvB,MAAM;IACN,KAAK;IACL,QAAQ,IAAA,iZAAa,EAAC,CAAC;IACvB,SAAS;QACP,kBAAkB,4GAAI,CAAC,OAAO,CAAC,SAAS;IAC1C;IACA,QAAQ,QAAQ,GAAG,CAAC,cAAc;IAClC,YAAY;QACV,YAAY,4GAAI,CAAC,OAAO,CAAC,SAAS;IACpC;IACA,SAAS;QACP,IAAA,wYAAiB,EAAS;YACxB,0BAA0B;YAC1B,aAAa;gBACX,OAAO,CAAC;gBACR,OAAO,CAAC;YACV;YACA,aAAa;gBACX,QAAQ;oBACN,MAAM,IAAM;oBACZ,QAAQ,CAAC,EAAE,GAAG,EAAE;wBACd,IAAI,IAAA,+IAAY,EAAC,IAAI,IAAI,GAAG;4BAC1B,OAAO;wBACT;wBACA,OAAO,IAAA,0JAAgB,EAAC,IAAI,IAAI,EAAE,MAAM,GAAG;oBAC7C;gBACF;YACF;YACA,mBAAmB;gBACjB,qBAAqB;YACvB;YACA,2BAA2B,CAAC,OAAS,IAAA,+IAAY,EAAC;QACpD;KACD;AACH"}},
    {"offset": {"line": 1532, "column": 0}, "map": {"version":3,"sources":["file:///Users/stefaniedoll/websites/prepublic/epaper-backend/src/app/%28payload%29/api/%5B...slug%5D/route.ts"],"sourcesContent":["/* THIS FILE WAS GENERATED AUTOMATICALLY BY PAYLOAD. */\n/* DO NOT MODIFY IT BECAUSE IT COULD BE REWRITTEN AT ANY TIME. */\nimport config from '@payload-config'\nimport { REST_DELETE, REST_GET, REST_OPTIONS, REST_PATCH, REST_POST } from '@payloadcms/next/routes'\n\nexport const GET = REST_GET(config)\nexport const POST = REST_POST(config)\nexport const DELETE = REST_DELETE(config)\nexport const PATCH = REST_PATCH(config)\nexport const OPTIONS = REST_OPTIONS(config)\n"],"names":[],"mappings":";;;;;;;;;;;;AAAA,qDAAqD,GACrD,+DAA+D,GAC/D;AACA;AAAA;AAAA;AAAA;AAAA;;;;;;;AAEO,MAAM,MAAM,IAAA,kaAAQ,EAAC,qIAAM;AAC3B,MAAM,OAAO,IAAA,qaAAS,EAAC,qIAAM;AAC7B,MAAM,SAAS,IAAA,2aAAW,EAAC,qIAAM;AACjC,MAAM,QAAQ,IAAA,waAAU,EAAC,qIAAM;AAC/B,MAAM,UAAU,IAAA,8aAAY,EAAC,qIAAM"}}]
}