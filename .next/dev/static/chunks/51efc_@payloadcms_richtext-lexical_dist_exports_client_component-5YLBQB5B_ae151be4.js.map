{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/stefaniedoll/websites/prepublic/epaper-backend/node_modules/.pnpm/%40payloadcms%2Brichtext-lexical%403.64.0_%40faceless-ui%2Bmodal%403.0.0_react-dom%4019.0.0_react%4019._bd7baf48251713852e8e278ca79c7dae/node_modules/%40payloadcms/richtext-lexical/src/features/upload/client/component/index.tsx"],"sourcesContent":["'use client'\nimport type { ClientCollectionConfig, Data, FormState, JsonObject } from 'payload'\n\nimport { useLexicalComposerContext } from '@lexical/react/LexicalComposerContext.js'\nimport { useLexicalEditable } from '@lexical/react/useLexicalEditable'\nimport { getTranslation } from '@payloadcms/translations'\nimport {\n  Button,\n  formatDrawerSlug,\n  Thumbnail,\n  useConfig,\n  useEditDepth,\n  usePayloadAPI,\n  useTranslation,\n} from '@payloadcms/ui'\nimport { $getNodeByKey, type ElementFormatType } from 'lexical'\nimport { isImage } from 'payload/shared'\nimport React, { useCallback, useId, useReducer, useRef, useState } from 'react'\n\nimport type { BaseClientFeatureProps } from '../../../typesClient.js'\nimport type { UploadData } from '../../server/nodes/UploadNode.js'\nimport type { UploadFeaturePropsClient } from '../index.js'\nimport type { UploadNode } from '../nodes/UploadNode.js'\n\nimport { useEditorConfigContext } from '../../../../lexical/config/client/EditorConfigProvider.js'\nimport { FieldsDrawer } from '../../../../utilities/fieldsDrawer/Drawer.js'\nimport { useLexicalDocumentDrawer } from '../../../../utilities/fieldsDrawer/useLexicalDocumentDrawer.js'\nimport { useLexicalDrawer } from '../../../../utilities/fieldsDrawer/useLexicalDrawer.js'\nimport { INSERT_UPLOAD_WITH_DRAWER_COMMAND } from '../drawer/commands.js'\nimport './index.scss'\n\nconst initialParams = {\n  depth: 0,\n}\n\nexport type ElementProps = {\n  className: string\n  data: UploadData\n  format?: ElementFormatType\n  nodeKey: string\n}\n\nexport const UploadComponent: React.FC<ElementProps> = (props) => {\n  const {\n    className: baseClass,\n    data: { fields, relationTo, value },\n    nodeKey,\n  } = props\n\n  if (typeof value === 'object') {\n    throw new Error(\n      'Upload value should be a string or number. The Lexical Upload component should not receive the populated value object.',\n    )\n  }\n\n  const {\n    config: {\n      routes: { api },\n      serverURL,\n    },\n    getEntityConfig,\n  } = useConfig()\n  const uploadRef = useRef<HTMLDivElement | null>(null)\n  const { uuid } = useEditorConfigContext()\n  const editDepth = useEditDepth()\n  const [editor] = useLexicalComposerContext()\n\n  const {\n    editorConfig,\n    fieldProps: { schemaPath },\n  } = useEditorConfigContext()\n  const isEditable = useLexicalEditable()\n  const { i18n, t } = useTranslation()\n  const [cacheBust, dispatchCacheBust] = useReducer((state) => state + 1, 0)\n  const [relatedCollection] = useState<ClientCollectionConfig>(() =>\n    getEntityConfig({ collectionSlug: relationTo }),\n  )\n\n  const componentID = useId()\n\n  const extraFieldsDrawerSlug = formatDrawerSlug({\n    slug: `lexical-upload-drawer-` + uuid + componentID, // There can be multiple upload components, each with their own drawer, in one single editor => separate them by componentID\n    depth: editDepth,\n  })\n\n  // Need to use hook to initialize useEffect that restores cursor position\n  const { toggleDrawer } = useLexicalDrawer(extraFieldsDrawerSlug, true)\n\n  const { closeDocumentDrawer, DocumentDrawer, DocumentDrawerToggler } = useLexicalDocumentDrawer({\n    id: value,\n    collectionSlug: relatedCollection.slug,\n  })\n\n  // Get the referenced document\n  const [{ data }, { setParams }] = usePayloadAPI(\n    `${serverURL}${api}/${relatedCollection.slug}/${value}`,\n    { initialParams },\n  )\n\n  const thumbnailSRC = data?.thumbnailURL || data?.url\n\n  const removeUpload = useCallback(() => {\n    editor.update(() => {\n      $getNodeByKey(nodeKey)?.remove()\n    })\n  }, [editor, nodeKey])\n\n  const updateUpload = useCallback(\n    (data: Data) => {\n      setParams({\n        ...initialParams,\n        cacheBust, // do this to get the usePayloadAPI to re-fetch the data even though the URL string hasn't changed\n      })\n\n      dispatchCacheBust()\n      closeDocumentDrawer()\n    },\n    [setParams, cacheBust, closeDocumentDrawer],\n  )\n\n  const hasExtraFields = (\n    editorConfig?.resolvedFeatureMap?.get('upload')\n      ?.sanitizedClientFeatureProps as BaseClientFeatureProps<UploadFeaturePropsClient>\n  ).collections?.[relatedCollection.slug]?.hasExtraFields\n\n  const onExtraFieldsDrawerSubmit = useCallback(\n    (_: FormState, data: JsonObject) => {\n      // Update lexical node (with key nodeKey) with new data\n      editor.update(() => {\n        const uploadNode: null | UploadNode = $getNodeByKey(nodeKey)\n        if (uploadNode) {\n          const newData: UploadData = {\n            ...uploadNode.getData(),\n            fields: data,\n          }\n          uploadNode.setData(newData)\n        }\n      })\n    },\n    [editor, nodeKey],\n  )\n\n  const aspectRatio =\n    thumbnailSRC && data?.width && data?.height\n      ? data.width > data.height\n        ? 'landscape'\n        : 'portrait'\n      : 'landscape'\n\n  return (\n    <div\n      className={`${baseClass}__contents ${baseClass}__contents--${aspectRatio}`}\n      data-filename={data?.filename}\n      ref={uploadRef}\n    >\n      <div className={`${baseClass}__card`}>\n        <div className={`${baseClass}__media`}>\n          <Thumbnail\n            collectionSlug={relationTo}\n            fileSrc={isImage(data?.mimeType) ? thumbnailSRC : null}\n            height={data?.height}\n            size=\"none\"\n            width={data?.width}\n          />\n\n          {isEditable && (\n            <div className={`${baseClass}__overlay ${baseClass}__floater`}>\n              <div className={`${baseClass}__actions`} role=\"toolbar\">\n                {hasExtraFields ? (\n                  <Button\n                    buttonStyle=\"icon-label\"\n                    className={`${baseClass}__upload-drawer-toggler`}\n                    disabled={!isEditable}\n                    el=\"button\"\n                    icon=\"edit\"\n                    onClick={toggleDrawer}\n                    round\n                    size=\"medium\"\n                    tooltip={t('fields:editRelationship')}\n                  />\n                ) : null}\n\n                <Button\n                  buttonStyle=\"icon-label\"\n                  className={`${baseClass}__swap-drawer-toggler`}\n                  disabled={!isEditable}\n                  el=\"button\"\n                  icon=\"swap\"\n                  onClick={() => {\n                    editor.dispatchCommand(INSERT_UPLOAD_WITH_DRAWER_COMMAND, {\n                      replace: { nodeKey },\n                    })\n                  }}\n                  round\n                  size=\"medium\"\n                  tooltip={t('fields:swapUpload')}\n                />\n\n                <Button\n                  buttonStyle=\"icon-label\"\n                  className={`${baseClass}__removeButton`}\n                  disabled={!isEditable}\n                  icon=\"x\"\n                  onClick={(e) => {\n                    e.preventDefault()\n                    removeUpload()\n                  }}\n                  round\n                  size=\"medium\"\n                  tooltip={t('fields:removeUpload')}\n                />\n              </div>\n            </div>\n          )}\n        </div>\n\n        <div className={`${baseClass}__metaOverlay ${baseClass}__floater`}>\n          <DocumentDrawerToggler className={`${baseClass}__doc-drawer-toggler`}>\n            <strong className={`${baseClass}__filename`}>\n              {data?.filename || t('general:untitled')}\n            </strong>\n          </DocumentDrawerToggler>\n          <div className={`${baseClass}__collectionLabel`}>\n            {getTranslation(relatedCollection.labels.singular, i18n)}\n          </div>\n        </div>\n      </div>\n\n      {value ? <DocumentDrawer onSave={updateUpload} /> : null}\n      {hasExtraFields ? (\n        <FieldsDrawer\n          data={fields}\n          drawerSlug={extraFieldsDrawerSlug}\n          drawerTitle={t('general:editLabel', {\n            label: getTranslation(relatedCollection.labels.singular, i18n),\n          })}\n          featureKey=\"upload\"\n          handleDrawerSubmit={onExtraFieldsDrawerSubmit}\n          schemaPath={schemaPath}\n          schemaPathSuffix={relatedCollection.slug}\n        />\n      ) : null}\n    </div>\n  )\n}\n"],"names":["useLexicalComposerContext", "useLexicalEditable", "getTranslation", "Button", "formatDrawerSlug", "Thumbnail", "useConfig", "useEditDepth", "usePayloadAPI", "useTranslation", "$getNodeByKey", "isImage", "useCallback", "useId", "useReducer", "useRef", "useState", "initialParams", "depth", "UploadComponent", "props", "className", "baseClass", "data", "fields", "relationTo", "value", "nodeKey", "Error", "config", "routes", "api", "serverURL", "getEntityConfig", "useConfig", "uploadRef", "useRef", "uuid", "useEditorConfigContext", "editDepth", "useEditDepth", "editor", "useLexicalComposerContext", "editorConfig", "fieldProps", "schemaPath", "isEditable", "useLexicalEditable", "i18n", "t", "useTranslation", "cacheBust", "dispatchCacheBust", "useReducer", "state", "relatedCollection", "useState", "collectionSlug", "componentID", "useId", "extraFieldsDrawerSlug", "formatDrawerSlug", "slug", "toggleDrawer", "useLexicalDrawer", "closeDocumentDrawer", "DocumentDrawer", "DocumentDrawerToggler", "useLexicalDocumentDrawer", "id", "setParams", "usePayloadAPI", "thumbnailSRC", "thumbnailURL", "url", "removeUpload", "useCallback", "update", "$getNodeByKey", "remove", "updateUpload", "hasExtraFields", "resolvedFeatureMap", "get", "sanitizedClientFeatureProps", "collections", "onExtraFieldsDrawerSubmit", "_", "uploadNode", "newData", "getData", "setData", "aspectRatio", "width", "height", "_jsxs", "filename", "ref", "_jsx", "Thumbnail", "fileSrc", "isImage", "mimeType", "size", "role", "Button", "buttonStyle", "disabled", "el", "icon", "onClick", "round", "tooltip", "dispatchCommand", "INSERT_UPLOAD_WITH_DRAWER_COMMAND", "replace", "e", "preventDefault", "getTranslation", "labels", "singular", "onSave", "FieldsDrawer", "drawerSlug", "drawerTitle", "label", "featureKey", "handleDrawerSubmit", "schemaPathSuffix"],"mappings":"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"}}]
}